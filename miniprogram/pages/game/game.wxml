<!--pages/game/game.wxml-->
<view class="container">
  <!-- å‡†å¤‡é˜¶æ®µ -->
  <view wx:if="{{gameState === 'ready'}}" class="game-ready">
    <view class="card text-center p-30">
      <view class="game-icon">ğŸ¯</view>
      <text class="title mb-20">å‡†å¤‡å¼€å§‹æŒ‘æˆ˜</text>
      <view class="text-gray">
        <view>ä»Šæ—¥ç›®æ ‡ï¼šåŒ¹é… 20 ä¸ªå•è¯</view>
        <view>åˆå§‹æ—¶é—´ï¼š90 ç§’</view>
        <view>æ­£ç¡®åŒ¹é…å¯è·å¾—é¢å¤–æ—¶é—´</view>
      </view>
    </view>
    
    <button class="btn btn-primary btn-large mt-30" bindtap="startGame">
      å¼€å§‹æŒ‘æˆ˜
    </button>
  </view>

  <!-- æ¸¸æˆè¿›è¡Œä¸­ -->
  <view wx:if="{{gameState === 'playing'}}" class="game-playing">
    <!-- æ¸¸æˆHUD -->
    <view class="game-hud card mb-20">
      <view class="hud-row">
        <view class="hud-item">
          <text class="hud-label">è¿›åº¦</text>
          <view class="progress-bar">
            <view class="progress-bar-fill" style="width: {{progress}}%"></view>
          </view>
          <text class="hud-value">{{progress}}%</text>
        </view>
      </view>
      
      <view class="hud-row">
        <view class="hud-item">
          <text class="hud-label">å¾—åˆ†</text>
          <text class="hud-value text-primary">{{score}}</text>
        </view>
        <view class="hud-item">
          <text class="hud-label">è¿å‡»</text>
          <text class="hud-value text-warning">Ã—{{combo}}</text>
        </view>
        <view class="hud-item">
          <text class="hud-label">æ—¶é—´</text>
          <text class="hud-value {{timeLeft < 30 ? 'text-danger' : ''}}">{{timeLeft}}s</text>
        </view>
      </view>
    </view>

    <!-- åŒ¹é…æ¿ -->
    <view class="match-board card">
      <!-- ç›®æ ‡å•è¯ -->
      <view class="word-display">
        <text class="word-text">{{currentWord.english}}</text>
        <text class="word-phonetic">{{currentWord.phonetic}}</text>
      </view>

      <!-- å€™é€‰ç­”æ¡ˆ -->
      <view class="candidates-grid">
        <block wx:for="{{candidates}}" wx:key="id">
          <view class="candidate-card {{item.selected ? 'selected' : ''}}" 
                data-id="{{item.id}}" 
                bindtap="selectCandidate">
            <text class="candidate-text">{{item.chinese}}</text>
          </view>
        </block>
      </view>
    </view>
  </view>

  <!-- æ¸¸æˆç»“æŸ -->
  <view wx:if="{{gameState === 'finished'}}" class="game-finished">
    <view class="result-modal card">
      <view class="result-header">
        <view class="result-icon">ğŸ‰</view>
        <text class="result-title">æŒ‘æˆ˜å®Œæˆï¼</text>
      </view>
      
      <view class="result-stats">
        <view class="stat-row">
          <text class="stat-label">å‡†ç¡®ç‡</text>
          <text class="stat-value">{{result.accuracy}}%</text>
        </view>
        <view class="stat-row">
          <text class="stat-label">ç”¨æ—¶</text>
          <text class="stat-value">{{result.timeUsed}}ç§’</text>
        </view>
        <view class="stat-row">
          <text class="stat-label">æœ€å¤§è¿å‡»</text>
          <text class="stat-value">Ã—{{result.comboMax}}</text>
        </view>
        <view class="stat-row">
          <text class="stat-label">æ–°æŒæ¡</text>
          <text class="stat-value">{{result.newMastered}}ä¸ª</text>
        </view>
        <view class="stat-row highlight">
          <text class="stat-label">æ€»å¾—åˆ†</text>
          <text class="stat-value text-primary">{{result.score}}</text>
        </view>
      </view>

      <view class="reward-section">
        <text class="reward-label">è·å¾—å¥–åŠ±</text>
        <text class="reward-text">{{result.rewardText}}</text>
      </view>

      <view class="result-actions">
        <button class="btn btn-secondary" bindtap="handleAgain">å†æ¥ä¸€æ¬¡</button>
        <button class="btn btn-primary" bindtap="handleHome">è¿”å›é¦–é¡µ</button>
      </view>
    </view>
  </view>

  <!-- Toastæç¤º -->
  <view wx:if="{{toast.show}}" class="toast {{toast.type}}">
    <text>{{toast.message}}</text>
  </view>
</view>
